<!-- authors: Ricky P & Michael L -->
<!-- new/edit squares form partial -->

<%= form_for(square) do |f| %>
  <%= render 'error_messages', object: f.object %>

	<!-- hidden field for school id, set to current teacher's school -->
  <% if local_assigns[:isNew] %>
    <%= f.hidden_field :school_id, :value => current_teacher.school_id%>
  <% end %>

  <!-- ID field -->
  <div class="row form-row">
  	<div class="col-xs-2 col-xs-offset-1">
  		<h4>Square ID:</h4>
  	</div> 
  	<div class="col-xs-2">
      <%= f.text_field :screen_name, required: true, class: "form-control",
      			maxlength: "4", onKeyup: "trackName(this.value)" %>
  	</div>
  </div>

	<!-- color and type fields, with interactive sample square -->
	<div class="row form-row vertical-align">
		<!-- color and icon spinners in the 1st column -->
		<div class="col-xs-4 col-xs-offset-1">

			<div class="row form-row">
				<div class="col-xs-3"><h4>Color: </h4></div>
				<div class="col-xs-6 col-xs-offset-3">
      		<%= f.select :color, squareColors.map {|color| [color.titleize, color]}, 
          		      {}, {class: 'form-control'} %>
				</div>
			</div>   <!-- row, color spinner -->
  
  		<div class="row form-row">
  			<div class="col-xs-3"><h4>Type: </h4></div>
		  	<!-- spinner has int value of Type masked with the name -->
  			<div class="col-xs-6 col-xs-offset-3">
      		<%= f.select :tracking_type,[['Duration',1],['Frequency',2],['Interval',3]], 
       		     {}, {class: 'form-control'} %>
  			</div>
  		</div>   <!-- row, type spinner -->
  	</div>   <!-- col, spinners -->

  	<div class="col-xs-4">
  		<!-- interactive sample square in this 2nd col -->
			<div class="col-xs-2 col-xs-offset-1">
	      <div id="sample-square-color" class="bsquare-icon <%= icon_color(square) %> text-center" >
	  			<h3 id="sample-square-name"><%= square.screen_name %></h3>
			    <span id="sample-square-icon" class="fa fa-fw fa-lg <%= fa_bsquare_icon(square) %>"></span>
	  		</div>   <!-- behavior-square -->
    	</div>
 		</div>   <!-- col, sample square -->
	</div>   <!-- row -->

  <div class="form-spacer">	&nbsp;</div>

  <!-- square description (required) -->
	<div class="row form-row">
		<div class="col-xs-2 col-xs-offset-1">
			<h4>Description:</h4>
		</div>
		<div class="col-sm-6">
		  <%= f.text_area :description, required: true, class: "form-control info-textarea" %>
		</div>
	</div>   <!-- form-row -->

  <!-- OK/cancel buttons. -->
  <div class="row pad40">
	  <div class="col-xs-6 col-xs-offset-1 text-center"> 
      <% if local_assigns[:isNew] %>
        <%= button_tag(type: 'submit', class: "btn btn-success") do %>Add New Square<%end%>
      <% else %>
        <%= button_tag(type: 'submit', class: "btn btn-success") do %>Save Changes<%end%>
      <% end %>
        		&nbsp; &nbsp; &nbsp;
	      <%= link_to 'Cancel', squares_path, class: "btn btn-danger" %>
    </div>
  </div>
<% end %>

<!-- 
	Javascript below is specifically for this Squares page.
	It makes the sample teacher icon change interactively with color or icon spinner.
	CSS ID's make this (spaghetti code) work: 
		#square_color - the Rails-created ID for the color spinner
		#square_tracking_tpye - the Rails-created ID for the tracking type checkbox
		#sample-square-color - div where sample icon color is set
		#sample-square-icon - div where icon is set based on tracking type
-->
<script>
	$(document).ready(function() {
		$('#square_color').change(function() {
			setColor();
		});
		$('#square_tracking_type').change(function() {
			setIcon();
		});
	});

	function setColor() {
		var color =  $('#square_color').find('option:selected').attr('value');
		$('#sample-square-color').removeClass();
		$('#sample-square-color').addClass('bsquare-icon');
		$('#sample-square-color').addClass('i-' + color);
		$('#sample-square-color').addClass('text-center');
	}
	function setIcon() {
		var icon =  $('#square_tracking_type').find('option:selected').attr('value');
		$('#sample-square-icon').removeClass();
		$('#sample-square-icon').addClass('fa fa-fw fa-lg');
		if( icon == 1) { 
		  $('#sample-square-icon').addClass('fa-clock-o');
		}
		else if( icon == 3) {
			$('#sample-square-icon').addClass('fa-info');
		}
	}
  function trackName( value) {
    //var name = document.getElementById("square_screen_name").value;
	  //var name =  $('#square_screen_name').find('option:selected').attr('value');
  	$("#sample-square-color h3").html(value);
	}	
</script>

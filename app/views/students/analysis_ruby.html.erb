<% provide(:title, "Ruby Report") %>

<!--page header -->
<%= render partial: 'student_page_header', 
			:locals => { 	:title => "Ruby Report", 
										:subtitle => "show session stats for one behavior square for #{ @student.full_name }"} %>

<style>
.show-on-regular-only { font-size: 1.0em; }
.show-on-skinny-only { font-size: 1.0em; }
.ruby-div-regular { font-size: 16px; font-family: Arial; }
.ruby-div-skinny { font-size: 14px; font-family: Arial; }
.report-page-break { page-break-before: always; }

.ruby-student-param { font-size: 1.4em; font-weight: bold; }
.ruby-param { text-decoration: underline; }

.ruby-content { font-size: 14px; font-family: Arial; }
.ruby-content li { padding-bottom: 8px; }

#ruby-title { border: 0px solid lightgray; border-radius: 18px; 
			background-color: white; padding: 0px 4px 12px 4px; }
#ruby-footer { position: fixed; bottom: 0; color: gray; }
</style>

<%= form_tag 'analysis_ruby', :method => 'get' do %>

	<% if @sessions.empty? %>
	
		<!-- If no sessions, then issue info message and not a form -->
		<div class="row form-row2 pad40">
			<div class="col-xs-10 form-group">
				<h4>Student <%= @student.full_name %> currently has no sessions to report.</h4>
				<br>
			</div>
			<div class="form-spacer"></div>
		</div>

	<% else %>

		<div class="row form-row2 pad20 hide-on-print">
			<div class="col-xs-8 col-md-6 form-group ">
				
				<!-- sessions spinner -->
				<label>Session</label>
				<%= select_tag 'session_id', 
							options_for_select( @sessions.order('created_at DESC').map{|c| [c.created_at.strftime("%a %b %-d, %Y"), c.id]}), 
							{  :include_blank => 'Select a session to export', :class => 'form-control form-input-tweak' } %>
			</div>
			<div class="col-xs-4  form-group">
				<!-- update report button; it's updated with a new session value -->
				<%= button_tag( type: 'submit', :disabled => (@sessions.empty?), 
							id: 'exportButton', name: "do_ruby",
							class: "btn btn-lg btn-success", style: "margin-top: 20px;") do %>Update report<% end %>
			</div>

			<div class="col-xs-12 pad20">
				<!-- "Print this" button is disabled if no session selected -->
				<% if @ruby_session %>
					<button class="btn btn-lg btn-primary" onclick="window.print();">Print this</button>
				<% else %>
					<button class="btn btn-lg btn-primary" onclick="window.print();" disabled>Print this</button>
				<% end %>
				&nbsp; &nbsp; &nbsp;
				<%= link_to analysis_path(@student.id), class: 'btn btn-lg btn-default navpanel-darkgray-button' do %>
							<span class="fa fa-fw fa-chevron-left"></span> Back to Analysis page
				<% end %>
			</div>
		</div>   <!-- row -->

	<% end %>   <!-- if-else -->
<% end %>   <!-- form -->


<% if @ruby_session %>

	<!-- print this and Back to buttons -->
	<div class="row form-row2 pad40 hide-on-print">

		<!-- accordion panel for Ruby Report options -->
		<div class="col-xs-12 pad40">
			<div class="panel-group" id="accordion">
	
			  <!-- RUBY OPTIONS panel -->
			  <div class="panel panel-danger">
					<div class="panel-heading">
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" 
									style="text-decoration: none;">
						<h4 class="panel-title">
							<span class="glyphicon glyphicon-plus"></span> &nbsp; Ruby options
						</h4>
						</a>
					</div>
					<div id="collapseOne" class="panel-collapse collapse">
						<div class="panel-body">
	
							<!-- options text -->
							<div class="col-xs-12 form-group">
								<h4>
									Tweak your report printout with these options.
								</h4>
							</div>
	
							<!-- Skinny checkbox -->
			        <div class="col-xs-6 form-group" style="padding-left: 40px;">
			        	<label class="checkbox">
			        		<h4>
				        		<input type="checkbox" id="skinnyCheckbox" class="pull-left" onclick="doSkinny()">
			        			&nbsp; Skinny form <small><br>&nbsp; scrunch your form for smaller printing</small>
			        		</h4>
			        	</label>
			        </div>
	
			        <!-- Page break checkbox -->
			        <div class="col-xs-6 form-group" style="padding-left: 40px;">
			        	<label class="checkbox">
			        		<h4>
				        		<input type="checkbox" id="pagebreakCheckbox" onclick="doPagebreak()">
			        			&nbsp; Page break <small><br>&nbsp; force a page break after the main table</small>
			        		</h4>
			        	</label>
			        </div>
						</div>
					</div>   <!-- collapseOne -->
				</div>   <!-- panel -->
			</div>   <!-- panel-group -->
		</div>
	</div>   <!-- row -->

	<div class="form-spacer pad40 hide-on-print"><br></div>

<!----------------------->
<!-- BEGIN RUBY REPORT -->
<!----------------------->

<div id="ruby-title" class="row form-row2 ruby-div-regular" >
	<div class="col-xs-6">
		<h3>Ruby Report</h3>
	</div>
	<div class="col-xs-6 text-right pad20">
		Session Date: <span style="text-decoration: underline;"> <%= ux_session_date(@ruby_session) %> </span>
	</div>

	<div class="clearfix"></div>

	<div class="col-xs-12 pad10">
		Student: <span class="ruby-student-param"> <%= @student.full_name %></span> &nbsp; ~ &nbsp;
		Teacher: <span class="ruby-param"><%= @teacher.full_name %></span> &nbsp; ~ &nbsp;
		Interval time: <span class="ruby-param"><%= @student.session_interval %> mins</span>
	</div>
	<div class="clearfix"></div>
	<div class="col-xs-12 pad20">
		This report summarizes the details of one behavior session.
	</div>
</div>   <!-- row -->

<!-- The main part: the table of squares pressed at each interval -->
<div class="row form-row2 ruby-div-regular">
	<div class="col-xs-12 center-block text-center" style="text-align: center; margin: 0 auto;">
		<br><br>
		<p>Table goes here...</p>
		<br><br>
	</div>
</div>

<!-- forced page break; it's turned on/off with the checkbox above -->
<div class="report-page-break" style="display: none;"></div>

<div class="row form-row2 pad20 ruby-div-regular">
	<div class="col-xs-12">
    <div class="show-on-regular-only">		<!-- regular-only div -->
			<h3>Squares key</h3>
			<p>The behavior squares assigned to this student are:</p>
			<ul>
				<% @squares.each do |each_square| %>
					<li><strong><%= each_square.screen_name %></strong> = <%= each_square.description %> &nbsp;</li>
				<% end %>
			</ul>
		</div>   <!-- regular-only div -->
		
		<div class="show-on-skinny-only" style="display: none;">		<!-- skinny-only div -->
			<strong>Squares key &mdash; </strong>
			<% @squares.each do |each_square| %>
				<strong><%= each_square.screen_name %></strong> = <%= each_square.description %> &nbsp;
			<% end %>
		</div>

	</div>
</div>   <!-- -->

<% end %>

<!-- simple footer; it's on print only -->
<div class="row text-center display-on-print-only">
	<div id="ruby-footer" class="col-xs-12 text-center">
		GeoGem &copy; 2018
	</div>
</div>

<script type="text/javascript">

	// this function handles the Skinny checkbox above
	function doSkinny() {
		var checkBox = document.getElementById("skinnyCheckbox");

		regularDivs = document.querySelectorAll(".show-on-regular-only");
		skinnyDivs = document.querySelectorAll(".show-on-skinny-only");

		if( checkBox.checked == true) {
			// 1) make regular-only divs display=none; make skinny divs display=block
			for( var i = 0; i < regularDivs.length; i++) {
				regularDivs[i].style.display = "none";
			}
			for( var i = 0; i < skinnyDivs.length; i++) {
				skinnyDivs[i].style.display = "block";
			}

			// 2) swap regular ruby divs for the skinny version
			var divs = document.querySelectorAll(".ruby-div-regular");
			console.log( "skinny: divs length=" + divs.length);
			for( var i = 0; i < divs.length; i++) {
				console.log( "skinny: i=" + i + ", divs=" + divs[i]);
				console.log( "skinny, cont: classlist=" + divs[i].classlist);
				divs[i].classList.add( "ruby-div-skinny");
				divs[i].classList.remove( "ruby-div-regular");
			}
		}
		else {
			// 1) make skinny-only divs display=none; make regular divs display=block
			for( var i = 0; i < regularDivs.length; i++) {
				regularDivs[i].style.display = "block";
			}
			for( var i = 0; i < skinnyDivs.length; i++) {
				skinnyDivs[i].style.display = "none";
			}

			// 2) swap skinny ruby divs for the regular version
			var divs = document.querySelectorAll(".ruby-div-skinny");
			console.log( "NOT skinny: divs length=" + divs.length);
			for( var i = 0; i < divs.length; i++) {
				divs[i].classList.add( "ruby-div-regular");
				divs[i].classList.remove( "ruby-div-skinny");
			}
		}
	}   // doSkinny()


	// this function handles the Page Break checkbox above
	function doPagebreak() {
		var checkBox = document.getElementById("pagebreakCheckbox");
		var divs = document.querySelectorAll(".report-page-break");
		for( i = 0; i < divs.length; i++) {
			if( checkBox.checked == true) {
				divs[i].style.display = "block"; 
			}
			else { 
				divs[i].style.display = "none"; 
			}
		}
	}  // doPagebreak()

</script>


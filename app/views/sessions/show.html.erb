<!-- @author: Matthew O & Alex P & Debra J-->
<% provide(:title, "Behavioral Session") %>

<!-- special navbar and page beginning for Behavior session -->
<%= render 'layouts/navbar_empty' %>

<div class="container">
	<div class="col-xs-10 col-xs-offset-1 col-sm-12 col-sm-offset-0 content-col">
		<%= render 'layouts/flash' %>

<div class="row pad20">
  <div class="col-xs-4 col-xs-offset-0">
    <a href="#collapseExample" data-toggle="collapse" aria-expanded="false" aria-controls="collapseExample">
      <button type="button" class="btn btn-lg btn-default">
        <span class="fa fa-fw fa-plus"></span> Session info
      </button>
    </a>
    &nbsp; &nbsp; &nbsp;
  </div>
  <div class="col-xs-8 text-right">
    <%= form_tag end_session_path, :method => :POST do %>
          <%= hidden_field_tag :start2 %>
          <%= hidden_field_tag :end2 %>

    <button type="button" class="btn btn-lg btn-info" onclick="undo();">
      <span class="fa fa-fw fa-undo" ></span> Undo
    </button>
    &nbsp; &nbsp; &nbsp;

    <button type="button" class="btn btn-lg btn-primary noteBtn">
      <span class="fa fa-fw fa-pencil-square-o"></span> Notes
    </button>
    &nbsp; &nbsp; &nbsp;

    <button type="submit" class="btn btn-lg btn-danger" name="end_sess2"
          onclick="return getEndTime()">
      <span class="fa fa-fw fa-stop-circle-o"></span> End Session
    </button>

    <% end %>
    
  </div>
</div>

<!-- Collapsible div with page header and session info -->
<!-- Collapse source is Bootstrap: http://getbootstrap.com/javascript/ -->
<div class="collapse" id="collapseExample">
  
  <%= render partial: 'session_page_header',
        :locals => { :title => "Behavior session",
        :subtitle => "record behaviors with student, #{ @student.full_name }"} %>

  <div class="row">
    <%= form_for(@session) do |f| %>
    <div class="col-xs-4 col-xs-offset-1">
      <h4>Teacher: </h4>
      <input readonly="readonly" class="form-control" type="text" value="<%= @teacher.full_name %>" />
    </div>
    <div class="col-xs-4">
      <h4>Student: </h4>
      <input readonly="readonly" class="form-control" type="text" value="<%= @student.full_name %>" />
    </div>
    <% end %>
    <div class="col-xs-5 col-xs-offset-1">
      <h4>Start time: <%= ux_session_start_time( @session) %> </h4>
    </div>
    <p id="start_time" style="display: none"></p>
  </div>
</div>   <!-- collapse div -->


<script>
  // handle collapsing session details section
  $(document).ready(function(){
    $('.collapse').on('shown.bs.collapse', function(){
      $(this).parent().find(".fa-plus").toggleClass("fa-plus fa-minus");
    });
    $('.collapse').on('hidden.bs.collapse', function(){
      $(this).parent().find(".fa-minus").toggleClass("fa-plus fa-minus");
    });
  });
</script>

<!-- Control the selection and unselection of the student roster -->
<script>
	$(document).ready(function() {
        $(".d-sq").click(function(){
            if(!$(this).hasClass("sq-active")) {
                $(this).addClass("sq-active");
            } else {
                $(this).removeClass("sq-active");
            }
        });
	});
</script>


<!-- Note Functionality -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.2.0/jquery-confirm.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.2.0/jquery-confirm.min.js"></script>


<!--Side bar -->
<div id="mySidenav" class="sidenav" style="display: none;">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <%= form_tag end_session_path, :method => :POST do%>
        <%= hidden_field_tag :start %>
        <%= hidden_field_tag :end %>
        <%= submit_tag "End Session", :name => 'end_sess1',  :onclick => "return getEndTime()", :class => "btn btn-lg btn-primary btnFix"%>
    <% end %>
</div>   <!--sidebar -->


<!-- Main Content -->
<div class="container-fluid pad40">
      <!-- Behavior Square Area -->
      <% @student.squares.each_with_index do |square, index| %>
          <% if index == 0 || index.even? %>
              <div class="row behavior-row">
          <% end %>
              <div class="col-xs-3 col-sm-offset-1 col-md-3 col-md-offset-0">
                  <% if square.tracking_type == 2 %>
                      <div class="wrapper frequency" name="<%= square.id %>">
                          <button class="counter square i-<%= square.color %>">
                              <div class="square i-<%= square.color %> text-center">
                                  <div class="col-xs-12">
                                      <h4><%= square.screen_name %> <label class="count">0</label></h4>
                                        <br><!--Used for spacing-->
                                  </div>
                                  <div class="col-xs-1 col-xs-offset-7">
                                      <span><i class="fa fa-bullseye icon-white"></i></span>
                                  </div>
                              </div><!--End Square-->
                          </button>
                      </div><!-- End Wrapper -->
                      <% end %>
                      <% if square.tracking_type == 3 %>
                      <div class="wrapper interval" name="<%= square.id %>">
                          <button class="counter square i-<%= square.color %>">
                              <div class="square i-<%= square.color %> text-center">
                                  <div class="col-xs-12">
                                          <h4><%= square.screen_name %> <label class="count">0</label></h4>
                                          <br><!--Used for spacing-->
                                  </div>
                                   <div class="col-xs-1 col-xs-offset-7">
                                      <span> <i class="fa fa-flash icon-white"></i></span>
                                  </div>
                              </div><!--End Square-->
                          </button>
                          </div><!-- End Wrapper -->
                      <% end %>
                      <% if square.tracking_type == 1 %>
                      <div class="wrapper duration" name="<%= square.id %>">
                          <button class="button-start square <%= icon_color(square) %>" id="button-start1">
                              <div class="d-sq square <%= icon_color(square) %> text-center">
                                  <div class="col-xs-12">
                                          <h4><%= square.screen_name %> </h4>
                                          <p id = "timer"><span id="minutes">00</span>:<span id="seconds">00</span></p>
                                  </div>
                                  <div class="col-xs-1 col-xs-offset-7">
                                      <span> <i class="fa fa-clock-o icon-white"></i></span>
                                  </div>
                              </div><!--End Square-->
                          </button>
                          </div><!-- End Wrapper -->
                      <% end %>
              </div><!--End Col -->
          <% if (index.odd?) || index == (@student.squares.size-1) %>
              </div>   <!-- row -->
          <% end %>
        <% end %>

</div><!-- container-fluid -->

<!-- not displayed, only used in timer js -->
<textarea class="eventLog" id = "eventLog" style="display:none;" disabled></textarea>

<div style="padding-bottom: 200px"></div>

  </div>
</div>

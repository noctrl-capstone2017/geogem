<!-- @author: Matthew O & Alex P & Debra J-->
<% provide(:title, "Behavioral Session") %>

<!-- special navbar and page beginning for Behavior session -->
<%= render 'layouts/navbar_empty' %>

<div class="container">
	<div class="col-xs-10 col-xs-offset-1 col-sm-12 col-sm-offset-0 content-col">
		<%= render 'layouts/flash' %>

<!-- Control the selection and unselection of the student roster -->
<script>
	$(document).ready(function() {
	  // highlight active behavior square
    $(".d-sq").click(function(){
        // if(!$(this).hasClass("sq-active")) {
        //     $(this).addClass("sq-active");
        // } else {
        //     $(this).removeClass("sq-active");
        // }
        $(this).toggleClass("sq-active")
        $(this).toggleClass( "blinky-div")
    });
    // handle collapsing session details section
    $('.collapse').on('shown.bs.collapse', function(){
      $(this).parent().find(".fa-plus").toggleClass("fa-plus fa-minus");
    });
    $('.collapse').on('hidden.bs.collapse', function(){
      $(this).parent().find(".fa-minus").toggleClass("fa-plus fa-minus");
    });
	});
</script>

<!-- Note Functionality -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.2.0/jquery-confirm.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.2.0/jquery-confirm.min.js"></script>


<div class="row pad20">
  <div class="col-xs-4 col-xs-offset-0">
    <a href="#collapseExample" data-toggle="collapse" aria-expanded="false" aria-controls="collapseExample">
      <button type="button" class="btn btn-lg btn-default">
        <span class="fa fa-fw fa-plus"></span> Session info
      </button>
    </a>
    &nbsp; &nbsp; &nbsp;
  </div>
  <div class="col-xs-8 text-right">
    <%= form_tag end_session_path, :method => :POST do %>
          <%= hidden_field_tag :start2 %>
          <%= hidden_field_tag :end2 %>

    <button type="button" class="btn btn-lg btn-info" onclick="undo();">
      <span class="fa fa-fw fa-undo" ></span> Undo
    </button>
    &nbsp; &nbsp; &nbsp;

    <button type="button" class="btn btn-lg btn-primary noteBtn">
      <span class="fa fa-fw fa-pencil-square-o"></span> Notes
    </button>
    &nbsp; &nbsp; &nbsp;

    <button type="submit" class="btn btn-lg btn-danger" name="end_sess2"
          onclick="return getEndTime()">
      <span class="fa fa-fw fa-stop-circle-o"></span> End Session
    </button>

    <% end %>

  </div>   <!-- col -->
</div>   <!-- row -->

<!-- Collapsible div with page header and session info -->
<!-- Collapse source is Bootstrap: http://getbootstrap.com/javascript/ -->
<div class="collapse" id="collapseExample">
  
  <%= render partial: 'session_page_header',
        :locals => { :title => "Behavior session",
        :subtitle => "record behaviors with student, #{ @student.full_name }"} %>

  <%= form_for(@session) do |f| %>
    <div class="row form-row">
      <div class="col-xs-2 col-xs-offset-1">
        <h4>Student: </h4>
      </div>
      <div class="col-xs-3">
        <input readonly="readonly" class="form-control" type="text" 
              value="<%= @student.full_name %>" />
      </div>
    </div>

    <div class="row form-row">
      <div class="col-xs-2 col-xs-offset-1">
        <h4>Teacher: </h4>
      </div>
      <div class="col-xs-3">
        <input readonly="readonly" class="form-control" type="text" 
              value="<%= @teacher.full_name %>" />
      </div>
    </div>

    <div class="row form-row">
      <div class="col-xs-2 col-xs-offset-1">
        <h4>Start time:</h4>
      </div>
      <div class="col-xs-3">
        <input readonly="readonly" class="form-control" type="text"
              value="<%= ux_session_start_time( @session) %>" />
      </div>
    </div>

  <% end %>   <!-- sessions form -->
</div>   <!-- collapse div -->

<!-- Side bar -->
<!-- need to hack timer.js to remove this div, currently it's just hidden -->
<div id="mySidenav" style="display:none">
  <p id="start_time"></p>
  <%= form_tag end_session_path, :method => :POST do %>
    <%= hidden_field_tag :start %>
    <%= hidden_field_tag :end %>
    <%= submit_tag "End Session", :name => 'end_sess1',  :onclick => "return getEndTime()" %>
  <% end %>
</div>   <!-- sidebar -->


<style>
.session-rect { height: 12em; border: 2px solid whitesmoke; }
.session-rect:hover { border-color: lightgray; }
.session-rect a:hover { text-decoration: none; }

/* Make duration square blink while active (ha!) */
/* Source: www.multipetros.gr/posts/728-blink-elements-border-the-css-way */
@keyframes blink { 50% { border-color: black; }  }
.blinky-div { animation: blink 1.0s step-end infinite alternate; }
</style>

<!-- Main Content -->
<div class="container-fluid pad40">
  <!-- Behavior Square Area -->
  <% @student.squares.each_with_index do |square, index| %>

    <% if ux_first_row( index) %>
      <div class="row behavior-row">
    <% end %>

    <% if ux_next_row( index, 2) %>
      </div>
      <div class="row behavior-row">
    <% end %>

    <% if index.even? %>
      <div class="col-xs-5 session-rect">
    <% else %>
      <div class="col-xs-5 col-xs-offset-1 session-rect">
    <% end %>

      <!-- DURATION behavior square -->
      <% if square.tracking_type == 1 %>
        <div class="row wrapper duration" name="<%= square.id %>">
          <div class="col-xs-4">
            <button class="button-start" id="button-start1">
              <div class="d-sq bsquare-session-icon <%= glow_color(square) %> text-center">
                <h2><%= square.screen_name %> </h2>
                <span class="fa fa-fw fa-2x <%= fa_bsquare_icon(square) %>"></span>
              </div>   <!-- square -->
            </button>
          </div>   <!-- col -->
          <div class="col-xs-8">
            <br>
            <h4>Duration = <span id = "timer"><span id="minutes">00</span>:<span id="seconds">00</span></span></h4>
            <p><i><%= truncate( square.description, :length => 120) %> </i></p>
          </div>
        </div>   <!-- wrapper -->
      <% end %>

      <!-- FREQUENCY behavior square -->
      <% if square.tracking_type == 2 %>
        <div class="row wrapper frequency" name="<%= square.id %>">
          <div class="col-xs-4">
            <button class="counter" >
              <div class="bsquare-session-icon <%= glow_color(square) %> text-center">
                <h3><%= square.screen_name %> </h3>
                <span class="fa fa-fq fa-2x <%= fa_bsquare_icon(square) %>"></span>
              </div>   <!-- square -->
            </button>
          </div>   <!-- col -->
          <div class="col-xs-8">
            <br>
            <h4 class="counter">Count = <label class="count">0</label></h4>
            <p><i><%= truncate( square.description, :length => 120) %> </i></p>
          </div>
        </div>   <!-- wrapper -->
      <% end %>

      <!-- INTERVAL behavior square -->
      <% if square.tracking_type == 3 %>
        <div class="row wrapper interval" name="<%= square.id %>">
          <div class="col-xs-4">
            <button class="counter" >
              <div class="bsquare-session-icon <%= glow_color(square) %> text-center">
                <h3><%= square.screen_name %> </h3>
                <span class="fa fa-fw fa-2x <%= fa_bsquare_icon(square) %>"></span>
              </div>   <!-- square -->
            </button>
          </div>   <!-- col -->
          <div class="col-xs-8">
            <br>
            <h4 class="counter">Count = <label class="count">0</label></h4>
            <p><i><%= truncate( square.description, :length => 120) %> </i></p>
          </div>
        </div>   <!-- wrapper -->
      <% end %>
    </div>   <!-- col -->

    <% if ux_last_row( index, @student.squares.size) %>
      </div>   <!-- row -->
    <% end %>

  <% end %>   <!-- for each behavior square -->

</div>   <!-- container-fluid -->


<!-- not displayed, only used in timer js -->
<textarea class="eventLog" id = "eventLog" style="display:none;" disabled></textarea>

<div style="padding-bottom: 200px"></div>

  </div>
</div>
